<!DOCTYPE html>
<html lang="en" class="text-slate-800 bg-slate-50">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Food Diary</title>
    <link rel="stylesheet" href="/main.css" />
    <script src="/main.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script>
      var app = Elm.Main.init({
        node: document.getElementById("root"),
        flags: rememberedBytes(),
      });

      /* Fetch back generated bytes from the local storage */
      function rememberedBytes() {
        const bytes = localStorage.getItem("bytes");
        return bytes ? bytes.split(",").map((x) => parseInt(x, 10)) : null;
      }

      /* Generate high entropy random bytes using the Web Crypto API and
       		 remember them so that they are preserved between redirections. This
       		 allows to protect for XSS & authorization code attacks
      */
      app.ports.genRandomBytes.subscribe((n) => {
        const buffer = new Uint8Array(n);
        crypto.getRandomValues(buffer);
        const bytes = Array.from(buffer);
        localStorage.setItem("bytes", bytes);
        app.ports.randomBytes.send(bytes);
      });
    </script>
  </body>
</html>
